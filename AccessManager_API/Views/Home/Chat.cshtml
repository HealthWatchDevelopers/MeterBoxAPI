<table style="width:100%;margin:0px;">
    <tr>
        <td style="width:1%;vertical-align:top;">
            <input type="button" id="reloadConnList" value="Load Connections" />
            <input type="text" id="displayname" placeholder="mesage" />
            <input type="text" id="message" placeholder="name" /><br />
            <table>
                <tr>
                    <td><input type="button" id="setkey" value="Set" /></td>
                    <td><input type="button" id="removekey" value="Rem" title="Remove Key" /></td>
                    <td><input type="button" id="clear" value="Clr" /></td>
                    <td><input type="button" id="Sublist" value="Sublist" /></td>
                </tr>
            </table>
            <input type="button" id="sendmessage" value="Send" />
            <input type="button" id="Broadcast" value="Broadcast" />
            <input type="button" id="sendJson" value="Json" />
            <input type="button" id="BlkList" value="BlkList" />

            <input type="button" id="cleardebug" value="Clr>>" />

            <ul id="discussion"></ul>
        </td>
        <td style="vertical-align:top;width:1px;" title="greyofficemobile">
            GreyMobiles
            <div id="container_greyofficemobile"></div>
        </td>
        <td style="vertical-align:top;width:1px;" title="dispatchers">
            Dispatchers
            <div id="container_dispatchers"></div>
        </td>
        <td style="vertical-align:top;width:1px;" title="accessmanager">
            Accessmgr
            <div id="container_accessmanager"></div>
        </td>
        <td style="vertical-align:top;width:1px;" title="doomdriver">
            DoomDriver
            <div id="container_doomdriver"></div>
        </td>
        <td style="vertical-align:top;width:1px;" title="DoomClient">
            DoomClient
            <div id="container_doomclient"></div>
        </td>
        <td style="vertical-align:top;width:1px;" title="logisticsclients">
            Log.Clients
            <div id="container_logisticsclients"></div>
        </td>
        <td style="vertical-align:top;width:1px;" title="doombrowser">
            DoomBrow
            <div id="container_doombrowser"></div>
        </td>
        <td style="vertical-align:top;width:1px;" title="Unknown">
            Unknown
            <div id="container_unknown"></div>
        </td>
    </tr>
</table>
<div id="blockList"></div>
<div id="subscriptionList"></div>
<ul id="debugmessage"></ul>

@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.3.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        function GetUrl() {
            //alert(window.location.hostname)
            //var arr = window.location.hostname.split(".");
            //if (arr.length == 1) return 'http://' + arr[0] + '/signalr';
            return 'http://' + window.location.hostname + '/signalr';
        } 
        $(function () {

            // Reference the auto-generated proxy for the hub.
            //$.connection.hub.url = 'http://localhost/signalr';
            //$.connection.hub.url = 'http://192.168.0.106/signalr';
            //$.connection.hub.url = 'http://www.doomtv.com/signalr';
            //$.connection.hub.url = 'http://localhost:56086/signalr';
            //$.connection.hub.url = 'http://api.GingerTracker.com/signalr';
            //$.connection.hub.url = 'http://api.TrillionTaxi.com/signalr';
            $.connection.hub.url = GetUrl();


            $.connection.hub.qs = { 'imei': 'debugger','type':'browser' };
            var chat = $.connection.chatHub;

            // Create a function that the hub can call back to display messages.
            chat.client.addNewMessageToPage = function (name, message) {
                // Add the message to the page.
                $('#discussion').append('<li><strong>' + htmlEncode(name)
                    + '</strong>: ' + htmlEncode(message) + '</li>');
            };
            chat.client.broadcastDebug = function (name, message) {
                // Add the message to the page.
                $('#debugmessage').append('<li><strong>' + htmlEncode(name)
                    + '</strong>: ' + htmlEncode(message) + '</li>');
            };

            // Get the user name and store it to prepend to messages.
            //$('#displayname').val(prompt('Enter your name:', ''));
            // Set initial focus to message input box.
            $('#message').focus();
            // Start the connection.
            $.connection.hub.start().done(function () {
                $('#sendmessage').click(function () {
                    // Call the Send method on the hub.
                    chat.server.send($('#displayname').val(), $('#message').val());
                    // Clear text box and reset focus for next comment.
                    //$('#displayname').val('');
                    $('#message').val('').focus();
                });
                $('#Broadcast').click(function () {
                    // Call the Send method on the hub.
                    chat.server.broadcast($('#displayname').val(), $('#message').val());
                    // Clear text box and reset focus for next comment.
                    //$('#displayname').val('');
                    //$('#message').val('').focus();
                });
                
                $('#sendJson').click(function () {
                    // Call the Send method on the hub.
                    chat.server.DispatchJsonToClient({imeiDriver:'imei..Driver',imeiClient:'imei...Client'});
                    // Clear text box and reset focus for next comment.
                    //$('#displayname').val('');
                    $('#message').val('').focus();
                });
                $('#setkey').click(function () {
                    chat.server.setkey($('#displayname').val(), $('#message').val());
                    $('#displayname').val('').focus();
                    $('#message').val('');
                });
                $('#removekey').click(function () {
                    chat.server.removekey($('#displayname').val(), $('#message').val());
                    $('#displayname').val('').focus();
                    $('#message').val('');
                });

                $('#clear').click(function () {
                    $("#discussion").empty();
                });
                $('#reloadConnList').click(function () {
                    $("#container_greyofficemobile").load('@Url.Action("GetGreyOfficeMobileList_todebug")');
                    $("#container_doomdriver").load('@Url.Action("GetDoomDriverList_todebug")');
                    $("#container_doomclient").load('@Url.Action("GetDoomClientList_todebug")');
                    $("#container_logisticsclients").load('@Url.Action("GetLogisticsClientsList_todebug")');
                    $("#container_accessmanager").load('@Url.Action("GetAccessManagerList_todebug")');
                    $("#container_dispatchers").load('@Url.Action("GetDispatchersList_todebug")');
                    $("#container_doombrowser").load('@Url.Action("GetDoomBrowserList_todebug")');
                    //$("#container_unknown").load('@Url.Action("GetDoomUnknownList_todebug")');

                });
                
                $('#BlkList').click(function () {
                    $("#blockList").load('@Url.Action("GetBlockedList")');
                });
                $('#Sublist').click(function () {
                    $("#subscriptionList").load('@Url.Action("GetSubscriptionList")');
                });

                $('#cleardebug').click(function () {
                    $("#debugmessage").empty();
                });

            });
        });
        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
        //$("#div1").load('@Url.Action("GetCurrentTime")');
    </script>
}